{% comment %}
  Custom Product Comparison Section
  Displays up to 4 products in a responsive comparison table
  Uses Product Comparison Specs meta objects for standardized comparison data
{% endcomment %}

{% stylesheet %}
  .custom-comparison {
    /* Base container styles */
    width: 100%;
    overflow: hidden;
  }

  /* Desktop: Full table layout */
  @media screen and (min-width: 750px) {
    .custom-comparison {
      clip-path: polygon(5% 0, 95% 0, 100% 10%, 100% 90%, 95% 100%, 5% 100%, 0 90%, 0 10%);
    }
  }

  .custom-comparison__table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 4px 0;
  }

  /* Product header with image, name, description, price */
  .custom-comparison__product-header {
    text-align: center;
    background-color: var(--color-bg);
    vertical-align: top;
    position: relative;
    height: 1px;
  }

  /* Active product highlighting */
  .custom-comparison__product-header.active {
    background-color: #E8E8E8;
  }

  .custom-comparison__product-image {
    width: 100%;
    height: auto;
    object-fit: cover;
    margin-bottom: 1rem;
  }

  .custom-comparison__product-name {

    margin-bottom: 0.5rem;
    color: var(--color-contrast-higher);
  }

  .custom-comparison__product-description {
    font-family: var(--font-body);
    font-size: var(--font-paragraph--size);
    color: var(--color-contrast-high);
    margin-bottom: 1rem;
    line-height: 1.4;
  }

  .custom-comparison__product-price {

    margin-bottom: 1rem;
  }

  /* Button styles */
  .custom-comparison__button {
    font-family: var(--font-button);
    font-weight: var(--font-weight-medium);
    font-size: 15px;
    padding: 1rem 2rem;
    background-color: var(--color-contrast-higher);
    color: var(--color-bg);
    border: none;
    text-decoration: none;
    display: inline-block;
    transition: background-color 0.2s ease;
    cursor: pointer;
    width: 100%;
    max-width: 200px;
    text-align: center;
  }

  .custom-comparison__button:hover {
    background-color: var(--color-contrast-high);
  }

  /* Field rows */
  .custom-comparison__field-row {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .custom-comparison__field-label {
    padding: 1rem;
    font-family: var(--font-body);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-paragraph--size);
    background-color: transparent;
    vertical-align: middle;
    width: 200px;
  }

  .custom-comparison__field-value {
    padding: 1rem;
    font-family: var(--font-body);
    font-size: var(--font-paragraph--size);
    background-color: var(--color-bg);
    vertical-align: middle;
    text-align: center;
  }

  /* Active product column highlighting */
  .custom-comparison__field-value.active {
    background-color: #E8E8E8;
  }

  /* Boolean field styling */
  .custom-comparison__check {
    width: 18px;
    height: 18px;
    display: inline-block;
  }

  .custom-comparison__dash {
    font-size: 18px;
    color: #6b7280;
  }

  /* Mobile: Horizontal scroll layout */
  @media screen and (max-width: 749px) {
    .custom-comparison {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .custom-comparison__table {
      min-width: 800px;
    }

    .custom-comparison__product-image {

    }

    /* Hide labels column on mobile */
    .custom-comparison__field-label {
      display: none;
    }

    .custom-comparison__field-value {
      font-size: 13px;
      min-width: 120px;
      text-align: left;
      padding: 0.75rem;
    }

    /* Mobile inline labels */
    .custom-comparison__field-value .mobile-label {
      display: block;
      font-weight: var(--font-weight-medium);
      font-size: 12px;
      color: var(--color-contrast-high);
      margin-bottom: 0.25rem;
    }

    .custom-comparison__field-value .mobile-value {
      display: block;
      font-size: 13px;
    }
  }

  /* Hide mobile labels on desktop */
  @media screen and (min-width: 750px) {
    .mobile-label {
      display: none;
    }
  }
{% endstylesheet %}

{%- liquid
  # Get the main product from section settings
  assign main_product = section.settings.main_product
  if main_product == blank
    assign main_product = product
  endif
  
  # Get comparison products
  assign comparison_products = section.settings.comparison_products
  
  # Get the first product's comparison specs to determine field structure
  assign spec_fields = null
  if main_product != blank and main_product.metafields.custom.comparison_specs != blank
    assign spec_fields = main_product.metafields.custom.comparison_specs.value
  endif
-%}

{% if main_product != blank and spec_fields != blank %}
  <section class="custom-comparison tw-py-16" {{ section.shopify_attributes }}>
    <div class="tw-mx-auto tw-max-w-7xl tw-px-4 tw-relative">
      <!-- Section Header -->
      {% if section.settings.heading != blank %}
        <h2 class="tw-text-center tw-mb-12">{{ section.settings.heading }}</h2>
      {% endif %}

      <!-- Comparison Table -->
      <div class="custom-comparison__table-container">
        <table class="custom-comparison__table">
          <!-- Product Headers Row -->
          <thead>
            <tr>
              <!-- Empty cell for field labels column -->
              <th class="custom-comparison__field-label"></th>
              
              <!-- Main Product -->
              <th class="custom-comparison__product-header active ">
                <div class="tw-h-full tw-flex tw-flex-col tw-justify-between tw-items-center tw-pb-8"> 
                  <div class=""> 
                  <!-- Product Image -->
                  {% if main_product.featured_image %}
                    {{
                      main_product.featured_image
                      | image_url: width: 400
                      | image_tag:
                        loading: 'lazy',
                        class: 'custom-comparison__product-image',
                        alt: main_product.title
                    }}
                  {% endif %}

                  <!-- Product Name -->
                  <h3 class="custom-comparison__product-name">{{ main_product.title }}</h3>

                  <!-- Product Description -->
                  {% assign short_description = main_product.metafields.custom.comparison_specs.value.comparison_short_description %}
                  {% if short_description == blank %}
                    {% assign short_description = main_product.description | strip_html | truncate: 100 %}
                  {% endif %}
                  <p class="custom-comparison__product-description">{{ short_description }}</p>

                  <!-- Product Price -->
                  <h5 class="custom-comparison__product-price tw-pb-4">
                    {{ main_product.price | money | remove: '.00' }}
                  </h5>
                </div>
                <!-- Add to Cart Button -->
                <button type="button" class="custom-comparison__button" onclick="document.querySelector('form[action*=\"/cart/add\"]')?.submit()">
                  Add to cart
                </button>
                </div>
              </th>
              
              <!-- Comparison Products -->
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <th class="custom-comparison__product-header  ">
                    <div class="tw-h-full tw-flex tw-flex-col tw-justify-between tw-items-center tw-pb-8"> 
                      <div class=""> 
                      <!-- Product Image -->
                      {% if comp_product.featured_image %}
                        {{
                          comp_product.featured_image
                          | image_url: width: 400
                          | image_tag:
                            loading: 'lazy',
                            class: 'custom-comparison__product-image',
                            alt: comp_product.title
                        }}
                      {% endif %}

                      <!-- Product Name -->
                      <h3 class="custom-comparison__product-name">{{ comp_product.title }}</h3>

                      <!-- Product Description -->
                      {% assign comp_short_description = comp_product.metafields.custom.comparison_specs.value.comparison_short_description %}
                      {% if comp_short_description == blank %}
                        {% assign comp_short_description = comp_product.description | strip_html | truncate: 100 %}
                      {% endif %}
                      <p class="custom-comparison__product-description">{{ comp_short_description }}</p>

                      <!-- Product Price -->
                      <h5 class="custom-comparison__product-price tw-pb-4">
                        {{ comp_product.price | money | remove: '.00' }}
                      </h5>

                    </div>
                    <!-- Shop Now Button -->
                    <a href="{{ comp_product.url }}" class="custom-comparison__button">
                      Shop now
                    </a>
                  </div>
                  </th>
                {% endif %}
              {% endfor %}
            </tr>
          </thead>

          <!-- Comparison Fields -->
          <tbody>
            <!-- Trip Length -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Trip length</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Trip length</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.trip_length | default: '—' }} days</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Trip length</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.trip_length | default: '—' }} days</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Weight -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Weight</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Weight</span>
                {% assign weight = main_product.metafields.custom.comparison_specs.value.weight %}
                <span class="mobile-value">{% if weight != blank %}{{ weight }} lbs{% else %}—{% endif %}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Weight</span>
                    {% assign comp_weight = comp_product.metafields.custom.comparison_specs.value.weight %}
                    <span class="mobile-value">{% if comp_weight != blank %}{{ comp_weight }} lbs{% else %}—{% endif %}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Capacity -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Capacity</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Capacity</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.capacity | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Capacity</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.capacity | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Dimensions -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Dimensions</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Dimensions</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.dimensions | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Dimensions</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.dimensions | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Type of Travel -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Type of travel</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Type of travel</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.type_of_travel | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Type of travel</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.type_of_travel | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Number of Pockets -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Number of pockets</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Number of pockets</span>
                {% assign pocket_count = main_product.metafields.custom.comparison_specs.value.number_of_pockets %}
                <span class="mobile-value">{{ pocket_count | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Number of pockets</span>
                    {% assign comp_pocket_count = comp_product.metafields.custom.comparison_specs.value.number_of_pockets %}
                    <span class="mobile-value">{{ comp_pocket_count | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Wheels -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Wheels</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Wheels</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.wheels | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Wheels</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.wheels | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Corner Protection -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Corner protection</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Corner protection</span>
                <span class="mobile-value">{{ main_product.metafields.custom.comparison_specs.value.corner_protection | default: '—' }}</span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Corner protection</span>
                    <span class="mobile-value">{{ comp_product.metafields.custom.comparison_specs.value.corner_protection | default: '—' }}</span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Padded External Pocket -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Padded external pocket</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Padded external pocket</span>
                {% assign has_padded_pocket = main_product.metafields.custom.comparison_specs.value.padded_external_pocket %}
                <span class="mobile-value">
                  {% if has_padded_pocket == true %}
                    <span class="custom-comparison__check">
                      <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                  {% elsif has_padded_pocket == false %}
                    <span class="custom-comparison__dash">—</span>
                  {% else %}
                    <span class="custom-comparison__dash">—</span>
                  {% endif %}
                </span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Padded external pocket</span>
                    {% assign comp_has_padded_pocket = comp_product.metafields.custom.comparison_specs.value.padded_external_pocket %}
                    <span class="mobile-value">
                      {% if comp_has_padded_pocket == true %}
                        <span class="custom-comparison__check">
                          <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      {% elsif comp_has_padded_pocket == false %}
                        <span class="custom-comparison__dash">—</span>
                      {% else %}
                        <span class="custom-comparison__dash">—</span>
                      {% endif %}
                    </span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Deep Packable Base -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Deep packable base</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Deep packable base</span>
                {% assign has_deep_base = main_product.metafields.custom.comparison_specs.value.deep_packable_base %}
                <span class="mobile-value">
                  {% if has_deep_base == true %}
                    <span class="custom-comparison__check">
                      <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                  {% elsif has_deep_base == false %}
                    <span class="custom-comparison__dash">—</span>
                  {% else %}
                    <span class="custom-comparison__dash">—</span>
                  {% endif %}
                </span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Deep packable base</span>
                    {% assign comp_has_deep_base = comp_product.metafields.custom.comparison_specs.value.deep_packable_base %}
                    <span class="mobile-value">
                      {% if comp_has_deep_base == true %}
                        <span class="custom-comparison__check">
                          <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      {% elsif comp_has_deep_base == false %}
                        <span class="custom-comparison__dash">—</span>
                      {% else %}
                        <span class="custom-comparison__dash">—</span>
                      {% endif %}
                    </span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>

            <!-- Includes Accessory Bag -->
            <tr class="custom-comparison__field-row">
              <td class="custom-comparison__field-label">Includes accessory bag</td>
              <td class="custom-comparison__field-value active">
                <span class="mobile-label">Includes accessory bag</span>
                {% assign includes_accessory = main_product.metafields.custom.comparison_specs.value.includes_accessory_bag %}
                <span class="mobile-value">
                  {% if includes_accessory == true %}
                    <span class="custom-comparison__check">
                      <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </span>
                  {% elsif includes_accessory == false %}
                    <span class="custom-comparison__dash">—</span>
                  {% else %}
                    <span class="custom-comparison__dash">—</span>
                  {% endif %}
                </span>
              </td>
              {% for comp_product in comparison_products limit: 3 %}
                {% if comp_product != blank and comp_product.id != main_product.id %}
                  <td class="custom-comparison__field-value">
                    <span class="mobile-label">Includes accessory bag</span>
                    {% assign comp_includes_accessory = comp_product.metafields.custom.comparison_specs.value.includes_accessory_bag %}
                    <span class="mobile-value">
                      {% if comp_includes_accessory == true %}
                        <span class="custom-comparison__check">
                          <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20.375 6L9.375 17L4.375 12" stroke="#727272" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      {% elsif comp_includes_accessory == false %}
                        <span class="custom-comparison__dash">—</span>
                      {% else %}
                        <span class="custom-comparison__dash">—</span>
                      {% endif %}
                    </span>
                  </td>
                {% endif %}
              {% endfor %}
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>
{% endif %}

{% schema %}
{
  "name": "Custom Comparison",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Compare Bags"
    },
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "paragraph",
      "content": "Select the main product (current product page) and up to 3 products to compare against it."
    },
    {
      "type": "product",
      "id": "main_product",
      "label": "Main Product",
      "info": "The primary product being compared (usually the current product)"
    },
    {
      "type": "product_list",
      "id": "comparison_products", 
      "label": "Comparison Products",
      "limit": 3,
      "info": "Select up to 3 products to compare against the main product"
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Custom Comparison",
      "settings": {
        "heading": "Compare Bags",
        "main_product": "{{ product }}"
      }
    }
  ]
}
{% endschema %}
